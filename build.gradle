plugins {
  id 'eclipse'
  id "com.moowork.node" version "0.11"
}

node {
  version = '4.1.1'
  npmVersion = '2.1.5'
  download = true
}

ext.libDir = "${project.buildDir}/lib/"
ext.jsxArgs = ['src/jsx', '--out-dir', ext.libDir]

task watchJsx << {
    jsxArgs.add(0, '--watch')
}

task compile(type: NodeTask) {
    script = file('node_modules/babel/bin/babel')
    args = jsxArgs
}

task test(type: NpmTask, dependsOn: ['compile']) {
    args = ['test']
}
 
task build(type: NodeTask, dependsOn: 'test') {
    script = file('node_modules/browserify/bin/cmd')
    args = ['-r', 'react', "$libDir/app.js", '-o', "$buildDir/bundle.js"]
}

task clean(type: Delete) {
    delete project.buildDir
}
